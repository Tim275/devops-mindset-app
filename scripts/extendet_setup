#!/bin/bash
set -e

echo "ğŸš€ Setting up development environment..."

# Git setup
git config --global push.autoSetupRemote true
git config --global --add safe.directory /workspaces/devops-projekt
git config --global user.name "${GIT_AUTHOR_NAME:-Tim275}"
git config --global user.email "${GIT_AUTHOR_EMAIL:-sagichdirnicht259@outlook.de}"

# Setup mise tools
mise trust
mise install

# WICHTIG: mise aktivieren fÃ¼r aktuelle Session
eval "$(mise activate bash)"

# Install Backend dependencies
echo "ğŸ“¦ Installing Backend dependencies..."
python -m pip install fastapi uvicorn pydantic

# Install Frontend dependencies
echo "ğŸ“¦ Installing Frontend dependencies..."
python -m pip install flask requests jinja2 pytest

# Install commitizen with proper PATH (CONDITIONAL!)
if ! command -v cz >/dev/null; then
    echo "ğŸ› ï¸ Installing commitizen..."
    python -m pip install --user pipx
    export PATH="/home/vscode/.local/bin:$PATH"
    echo 'export PATH="/home/vscode/.local/bin:$PATH"' >> ~/.bashrc
    pipx install commitizen
    echo "âœ… commitizen installed"
fi

echo ""
echo "âœ… Setup complete!"
echo "Tools:"
command -v python && echo "âœ… python: $(python --version)" || echo "âŒ python"
command -v cz && echo "âœ… commitizen" || echo "âŒ commitizen"
echo ""
echo "ğŸ¯ Ready for development!"
echo "ğŸ’¡ Backend: ./scripts/start_backend (Port 22112)"
echo "ğŸ’¡ Frontend: ./scripts/start_frontend (Port 22111)"
echo "ğŸ’¡ Tests: ./scripts/run_tests"
echo "ğŸ’¡ Note: Run 'eval \"\$(mise activate bash)\"' in new shells"